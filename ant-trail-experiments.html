<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Art Remix</title>
    <!-- Add html2canvas library for reliable export -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #ffffff;
            font-family: Arial, sans-serif;
        }
        
        .scene-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            z-index: -110;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
        
        .ant {
            filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.3));
        }
        
        .leg {
            transform-origin: 0 0;
        }
        
        .path-line {
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .filled-area {
            opacity: 0.8;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 10px 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-width: 95%;
            width: auto;
        }
        
        .control {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        
        .control label {
            margin-bottom: 5px;
            font-size: 12px;
            color: #333;
            text-align: center;
        }
        
        .control input {
            width: 80px;
        }
        
        .control button {
            padding: 5px 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .control button:hover {
            background: #45a049;
        }

        /* Settings panel */
        .settings-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 200;
            transition: transform 0.3s ease;
        }

        .settings-icon:hover {
            transform: rotate(30deg);
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100vh;
            background-color: rgba(255, 255, 255, 0.75);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: right 0.3s ease;
            z-index: 150;
            overflow-y: auto;
        }
        
        /* Move the controls inside the settings panel */
        .settings-panel .control {
            margin-bottom: 15px;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-header h3 {
            margin: 0;
        }



        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .color-picker-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-preview {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 10px;
            border: 1px solid #ccc;
        }

        select.palette-selector {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
        }
        
        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .controls {
                padding: 8px 12px;
                gap: 10px;
                bottom: 10px;
            }
            
            .control {
                min-width: 70px;
            }
            
            .control label {
                font-size: 10px;
            }
            
            .control input {
                width: 70px;
            }
            
            .control button {
                padding: 4px 8px;
                font-size: 10px;
            }

            .settings-panel {
                width: 250px;
            }

            .settings-icon {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="scene-container">
        <svg id="canvas" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid slice">
            <!-- Filled areas will be added here -->
            <g id="filledAreas"></g>
            <!-- Path lines will be added here -->
            <g id="pathLines"></g>
            <!-- Creatures -->
            <g id="creatures">
                <!-- Ant SVG -->
                <g id="ant" class="creature" transform="translate(0, 0) rotate(0)">
                    <!-- Ant abdomen (rear part) -->
                    <ellipse cx="-8" cy="0" rx="10" ry="8" fill="#222222" />
                    <!-- Ant thorax (middle part) -->
                    <ellipse cx="5" cy="0" rx="7" ry="6" fill="#333333" />
                    <!-- Ant head -->
                    <circle cx="15" cy="0" r="5" fill="#444444" />
                    <!-- Antennae -->
                    <path d="M18,-2 Q25,-10 30,-8" stroke="#333333" stroke-width="1" fill="none" />
                    <path d="M18,2 Q25,10 30,8" stroke="#333333" stroke-width="1" fill="none" />
                    <!-- Mandibles -->
                    <path d="M20,-2 Q23,-4 24,-3" stroke="#333333" stroke-width="1" fill="none" />
                    <path d="M20,2 Q23,4 24,3" stroke="#333333" stroke-width="1" fill="none" />
                    <!-- Legs (left side) -->
                    <g id="leftLegs">
                        <path id="leftFrontLeg" class="leg" d="M8,-5 Q2,-15 -5,-18" stroke="#333333" stroke-width="1.5" fill="none" />
                        <path id="leftMiddleLeg" class="leg" d="M2,-5 Q-3,-12 -8,-10" stroke="#333333" stroke-width="1.5" fill="none" />
                        <path id="leftRearLeg" class="leg" d="M-5,-5 Q-12,-15 -18,-18" stroke="#333333" stroke-width="1.5" fill="none" />
                    </g>
                    <!-- Legs (right side) -->
                    <g id="rightLegs">
                        <path id="rightFrontLeg" class="leg" d="M8,5 Q2,15 -5,18" stroke="#333333" stroke-width="1.5" fill="none" />
                        <path id="rightMiddleLeg" class="leg" d="M2,5 Q-3,12 -8,10" stroke="#333333" stroke-width="1.5" fill="none" />
                        <path id="rightRearLeg" class="leg" d="M-5,5 Q-12,15 -18,18" stroke="#333333" stroke-width="1.5" fill="none" />
                    </g>
                </g>
                
                <!-- Ladybird SVG -->
                <g id="ladybird" class="creature" transform="translate(0, 0) rotate(0)" style="display: none;">
                    <!-- Body (main shell) -->
                    <ellipse cx="0" cy="0" rx="15" ry="12" fill="#E53935" />
                    <!-- Head -->
                    <circle cx="15" cy="0" r="5" fill="#111111" />
                    <!-- Spots -->
                    <circle cx="-8" cy="-5" r="2.5" fill="#111111" />
                    <circle cx="-2" cy="2" r="2.5" fill="#111111" />
                    <circle cx="5" cy="-6" r="2.5" fill="#111111" />
                    <circle cx="8" cy="4" r="2.5" fill="#111111" />
                    <!-- Center line -->
                    <path d="M0,-12 L0,12" stroke="#111111" stroke-width="1" />
                    <!-- Antennae -->
                    <path d="M17,-2 Q22,-8 25,-6" stroke="#111111" stroke-width="1" fill="none" />
                    <path d="M17,2 Q22,8 25,6" stroke="#111111" stroke-width="1" fill="none" />
                    <!-- Legs (left side) -->
                    <g id="ladybirdLeftLegs">
                        <path class="leg" d="M8,-8 Q2,-15 -5,-18" stroke="#111111" stroke-width="1.5" fill="none" />
                        <path class="leg" d="M0,-8 Q-5,-15 -10,-18" stroke="#111111" stroke-width="1.5" fill="none" />
                        <path class="leg" d="M-8,-8 Q-12,-15 -18,-18" stroke="#111111" stroke-width="1.5" fill="none" />
                    </g>
                    <!-- Legs (right side) -->
                    <g id="ladybirdRightLegs">
                        <path class="leg" d="M8,8 Q2,15 -5,18" stroke="#111111" stroke-width="1.5" fill="none" />
                        <path class="leg" d="M0,8 Q-5,15 -10,18" stroke="#111111" stroke-width="1.5" fill="none" />
                        <path class="leg" d="M-8,8 Q-12,15 -18,18" stroke="#111111" stroke-width="1.5" fill="none" />
                    </g>
                </g>
            </g>
        </svg>
    </div>

    <!-- Settings Icon -->
    <div class="settings-icon" id="settingsIcon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-section">
            <h4>Controls</h4>
            <div class="control">
                <label for="speed">Speed</label>
                <input type="range" id="speed" min="1" max="10" value="5">
            </div>
            <div class="control">
                <label for="lineWidth">Line Width</label>
                <input type="range" id="lineWidth" min="1" max="10" value="2">
            </div>
            <div class="control">
                <label for="maxPathLength">Max Length</label>
                <input type="range" id="maxPathLength" min="100" max="5000" step="100" value="1000">
            </div>
            <div class="control">
                <button id="pausePlay">Pause</button>
            </div>
            <div class="control">
                <button id="reset">Reset Art</button>
            </div>
            <div class="control">
                <button id="exportButton">Export</button>
            </div>
        </div>

        <div class="settings-section">
            <h4>Ant Trail</h4>
            <div class="color-picker-container">
                <label for="trailColor">Trail Color <span class="color-preview" id="trailColorPreview" style="background-color: black;"></span></label>
                <input type="color" id="trailColor" value="#000000">
            </div>
        </div>

        <div class="settings-section">
            <h4>Art Palette</h4>
            <select id="paletteSelector" class="palette-selector">
                <option value="pastel">Pastel</option>
                <option value="bright">Bright</option>
                <option value="subtle">Subtle</option>
                <option value="golden">Golden</option>
                <option value="seascape">Seascape</option>
                <option value="tinted-monochrome">Tinted Monochrome</option>
                <option value="neon">Neon</option>
                <option value="random">Random Colors</option>
            </select>
        </div>

        <div class="settings-section">
            <h4>Pattern Style</h4>
            <select id="patternSelector" class="palette-selector">
                <option value="spiral">Spiral</option>
                <option value="fractal">Fractal</option>
                <option value="zigzag">Zigzag</option>
                <option value="random">Random</option>
            </select>
        </div>

        <div class="settings-section">
            <h4>Creature</h4>
            <select id="creatureSelector" class="palette-selector">
                <option value="ant">Ant</option>
                <option value="ladybird">Ladybird</option>
            </select>
        </div>
        <div class="settings-section">
            <p style="font-size: 4rem; line-height: 0; font-weight: bold; font-family: serif; color: purple; text-shadow: 0 0 20px yellow;">ant</p>
            <p style="font-size: 4rem; line-height: 0; font-weight: bold; font-family: serif; color: purple; text-shadow: 0 0 20px yellow;">art</p>
            <p style="font-size: 4rem; line-height: 0; font-weight: bold; font-family: serif; color: purple; text-shadow: 0 0 20px yellow;">remix</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get elements
            const canvas = document.getElementById('canvas');
            const creatures = document.getElementById('creatures');
            const ant = document.getElementById('ant');
            const ladybird = document.getElementById('ladybird');
            const pathLines = document.getElementById('pathLines');
            const settingsIcon = document.getElementById('settingsIcon');
            const settingsPanel = document.getElementById('settingsPanel');
            const closeSettings = document.getElementById('closeSettings');
            const trailColor = document.getElementById('trailColor');
            const trailColorPreview = document.getElementById('trailColorPreview');
            const paletteSelector = document.getElementById('paletteSelector');
            const creatureSelector = document.getElementById('creatureSelector');
            const patternSelector = document.getElementById('patternSelector');
            const filledAreas = document.getElementById('filledAreas');
            
            // Current active creature
            let activeCreature = ant;
            
            // Controls
            const speedControl = document.getElementById('speed');
            const lineWidthControl = document.getElementById('lineWidth');
            const maxPathLengthControl = document.getElementById('maxPathLength');
            const pausePlayButton = document.getElementById('pausePlay');
            const resetButton = document.getElementById('reset');
            
            // Get SVG dimensions
            const svgRect = canvas.getBoundingClientRect();
            const viewBox = canvas.viewBox.baseVal;
            let svgWidth = viewBox.width;
            let svgHeight;
            
            // Set SVG height based on viewBox aspect ratio, regardless of device
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const isMobileCheck = window.innerWidth <= 600;
            
            // Always use the full height of the SVG viewBox
            svgHeight = viewBox.height;
            
            // Animation variables
            let antX = -50; // Start off-screen
            let antY = svgHeight / 2;
            let antAngle = 0;
            let targetX = Math.random() * svgWidth;
            let targetY = Math.random() * svgHeight;
            let speed = parseInt(speedControl.value);
            let lineWidth = parseInt(lineWidthControl.value);
            let maxPathLength = parseInt(maxPathLengthControl.value);
            let isMobile = window.innerWidth <= 600;
            let animationId;
            let entryComplete = false;
            let stepCount = 0;
            let curveAngle = 0;
            let curveFrequency = 0.02;
            let curveAmplitude = 20;
            let areaCount = 0;
            let isPaused = false;
            let currentPattern = "spiral";
            let spiralRadius = 10;
            let spiralAngle = 0;
            let fractalDepth = 0;
            let fractalMaxDepth = 5;
            let zigzagCounter = 0;
            let zigzagDirection = 1;
            let colorChangeCounter = 0;
            let gradientSteps = 10; // Number of steps for color gradient transitions
            
            // Path data
            let currentPath = null;
            let currentPathPoints = [];
            let currentPathSegments = [];
            let allPaths = [];
            let pathId = 0;
            
            // For smooth direction changes
            let currentDirection = 0;
            let targetDirection = 0;
            let directionChangeSpeed = 0.05;
            
            // Color palettes
            const palettes = {
                pastel: [
                    '#FFB6C1', // Light Pink
                    '#AFEEEE', // Pale Turquoise
                    '#FFFFE0', // Light Yellow
                    '#D8BFD8', // Thistle
                    '#98FB98', // Pale Green
                    '#FFA07A'  // Light Salmon
                ],
                bright: [
                    '#FF0000', // Red
                    '#00FF00', // Green
                    '#0000FF', // Blue
                    '#FFFF00', // Yellow
                    '#FF00FF', // Magenta
                    '#00FFFF'  // Cyan
                ],
                subtle: [
                    '#E6E6FA', // Lavender
                    '#F0F8FF', // Alice Blue
                    '#F5F5DC', // Beige
                    '#F0FFF0', // Honeydew
                    '#F5FFFA', // Mint Cream
                    '#F8F8FF'  // Ghost White
                ],
                golden: [
                    '#FFD700', // Gold
                    '#DAA520', // Goldenrod
                    '#B8860B', // Dark Goldenrod
                    '#CD853F', // Peru
                    '#D2B48C', // Tan
                    '#F4A460'  // Sandy Brown
                ],
                seascape: [
                    '#00FFFF', // Aqua
                    '#5F9EA0', // Cadet Blue
                    '#00CED1', // Dark Turquoise
                    '#008B8B', // Dark Cyan
                    '#20B2AA', // Light Sea Green
                    '#48D1CC'  // Medium Turquoise
                ],
                'tinted-monochrome': [
                    '#696969', // Dim Gray
                    '#808080', // Gray
                    '#A9A9A9', // Dark Gray
                    '#C0C0C0', // Silver
                    '#D3D3D3', // Light Gray
                    '#DCDCDC'  // Gainsboro
                ],
                'neon': [
                    '#FF00FF', // Magenta
                    '#00FFFF', // Cyan
                    '#39FF14', // Neon Green
                    '#FE59C2', // Neon Pink
                    '#CCF600', // Neon Yellow
                    '#FD5B78'  // Wild Watermelon
                ],
                random: [] // Will be generated on demand
            };
            
            // Current color palette
            let colorPalette = palettes.pastel;
            
            // Function to interpolate between two colors for gradients
            function interpolateColor(color1, color2, factor) {
                // Convert hex to RGB
                const hex1 = color1.substring(1);
                const hex2 = color2.substring(1);
                
                // Parse the hexes
                const r1 = parseInt(hex1.substring(0, 2), 16);
                const g1 = parseInt(hex1.substring(2, 4), 16);
                const b1 = parseInt(hex1.substring(4, 6), 16);
                
                const r2 = parseInt(hex2.substring(0, 2), 16);
                const g2 = parseInt(hex2.substring(2, 4), 16);
                const b2 = parseInt(hex2.substring(4, 6), 16);
                
                // Interpolate
                const r = Math.round(r1 + factor * (r2 - r1));
                const g = Math.round(g1 + factor * (g2 - g1));
                const b = Math.round(b1 + factor * (b2 - b1));
                
                // Convert back to hex
                return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, '0')}`;
            }
            
            // Initialize ant position
            updateAntPosition();
            
            // Animation functions
            function animate() {
                // Skip animation if paused
                if (isPaused) {
                    animationId = requestAnimationFrame(animate);
                    return;
                }
                // Entry animation
                if (!entryComplete) {
                    if (antX < 50) {
                        antX += speed;
                        updateAntPosition();
                    } else {
                        entryComplete = true;
                        // Start new path
                        startNewPath();
                        // Set first target based on pattern
                        setPatternTarget();
                    }
                } else {
                    // Move according to selected pattern
                    moveAccordingToPattern();
                    
                    // Animate legs based on movement
                    if (activeCreature === ant) {
                        animateLegs();
                    } else if (activeCreature === ladybird) {
                        animateLadybirdLegs();
                    }
                    
                    // Update ant position
                    updateAntPosition();
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            function moveAccordingToPattern() {
                const prevX = antX;
                const prevY = antY;
                
                // Different movement patterns
                switch(currentPattern) {
                    case "spiral":
                        moveInSpiral();
                        break;
                    case "fractal":
                        moveInFractal();
                        break;
                    case "zigzag":
                        moveInZigzag();
                        break;
                    case "random":
                    default:
                        moveRandomly();
                        break;
                }
                
                // Update trail with dynamic color changes
                updateTrail(prevX, prevY, antX, antY);
                
                // Check for intersections
                checkIntersections();
            }
            
            function moveInSpiral() {
                // Increase spiral angle
                spiralAngle += (0.05 * speed);
                // Gradually increase spiral radius
                spiralRadius += (0.15 * speed);
                
                // Calculate position based on spiral equation
                const centerX = svgWidth / 2;
                const centerY = svgHeight / 2;
                
                antX = centerX + Math.cos(spiralAngle) * spiralRadius;
                antY = centerY + Math.sin(spiralAngle) * spiralRadius;
                
                // Reset spiral if it gets too large
                if (spiralRadius > Math.min(svgWidth, svgHeight) * 0.4) {
                    spiralRadius = 10;
                    // Change direction occasionally
                    if (Math.random() > 0.7) {
                        spiralAngle = -spiralAngle;
                    }
                    
                    // Create a new path
                    currentPath = null;
                    currentPathPoints = [];
                    currentPathSegments = [];
                    startNewPath();
                }
                
                // Set angle for ant rotation
                antAngle = spiralAngle + Math.PI/2; // Perpendicular to spiral direction
            }
            
            function moveInFractal() {
                fractalDepth++;
                
                // Calculate fractal branching
                const angle = (fractalDepth % 4) * (Math.PI/2); // 90 degree turns
                const moveDistance = 10 * speed * Math.pow(0.9, Math.floor(fractalDepth/4)); // Decreasing steps
                
                antX += Math.cos(angle) * moveDistance;
                antY += Math.sin(angle) * moveDistance;
                
                antAngle = angle;
                
                // Check if we need to reset the fractal pattern
                if (fractalDepth > fractalMaxDepth || 
                    antX < 0 || antX > svgWidth || antY < 0 || antY > svgHeight) {
                    // Reset fractal and start at a new random position
                    fractalDepth = 0;
                    fractalMaxDepth = Math.floor(Math.random() * 20) + 10;
                    
                    antX = Math.random() * svgWidth;
                    antY = Math.random() * svgHeight;
                    
                    // Start a new path
                    currentPath = null;
                    currentPathPoints = [];
                    currentPathSegments = [];
                    startNewPath();
                }
            }
            
            function moveInZigzag() {
                zigzagCounter += speed;
                
                // Zigzag movement
                const zigzagWidth = 50;
                const forwardSpeed = 2 * speed;
                
                // Move forward and side to side
                antX += forwardSpeed;
                antY += Math.sin(zigzagCounter * 0.1) * zigzagWidth * zigzagDirection;
                
                // Set angle for ant rotation - point in direction of movement
                antAngle = Math.atan2(
                    Math.sin(zigzagCounter * 0.1) * zigzagWidth * zigzagDirection,
                    forwardSpeed
                );
                
                // Change direction or reset if reaching borders
                if (antX > svgWidth || antX < 0 || antY > svgHeight || antY < 0) {
                    // Reset position to somewhere inside the canvas
                    if (antX > svgWidth) antX = 0;
                    if (antX < 0) antX